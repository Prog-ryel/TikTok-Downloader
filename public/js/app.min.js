!function(){const e=document.getElementById("videoUrl"),t=document.getElementById("pasteBtn"),n=document.getElementById("clearBtn"),o=document.getElementById("previewBtn"),i=document.querySelector(".preview-section"),a=document.getElementById("downloadBtn"),d=document.querySelector(".progress-section"),s=document.querySelector(".progress"),l=document.getElementById("statusText"),r=document.getElementById("openDownloadsBtn"),c=document.getElementById("videoThumbnail"),u=document.getElementById("videoTitle"),p=document.getElementById("videoAuthor"),m=document.getElementById("videoDuration").querySelector("span"),v=document.getElementById("videoPlayer"),y=document.querySelector(".video-player-section"),f=document.getElementById("viewVideoBtn"),h=document.getElementById("howToUseBtn"),M=document.getElementById("howToUseModal"),U=document.getElementById("closeModalBtn");let b=null;function g(e,t){l.textContent=e,s.style.width=`${t}%`}function w(e){g(`Error: ${e}`,0),d.style.display="block"}async function k(){if(!b)return void w("No video data available");try{const t=document.querySelector('input[name="format"]:checked').value,n=e.value.trim();if(!n)return void w("Please enter a TikTok video URL");g("Starting download...",20),d.style.display="block";const o=await fetch("/api/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:n,format:t})});if(!o.ok)throw new Error("Download failed");const i=window.URL.createObjectURL(await o.blob()),a=document.createElement("a");a.href=i,a.download=`tiktok_${t==="mp3"?"audio":"video"}.${t}`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(i);const r=b.duration?` (${b.duration} seconds)`:"";g(`Download completed${r}! Check your downloads folder.`,100)}catch(e){w(e.message)}}t.addEventListener("click",async()=>{try{const t=await navigator.clipboard.readText();e.value=t,o.click()}catch(e){w("Failed to paste from clipboard")}}),n.addEventListener("click",()=>{e.value="",i.style.display="none",d.style.display="none",y.style.display="none",v.src="",b=null,a.removeAttribute("href"),a.style.pointerEvents="none",a.style.opacity="0.5"}),o.addEventListener("click",async()=>{const t=e.value.trim();if(!t)return void w("Please enter a TikTok video URL");try{g("Fetching video information...",20),d.style.display="block",y.style.display="none",a.style.pointerEvents="none",a.style.opacity="0.5";const n=await fetch("/api/video-info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:t})}),o=await n.json();if(o.code===0&&o.data){b=o.data,function(e){e&&(c.src=e.cover||"",u.textContent=e.title||"Untitled",p.textContent=`Author: ${(e.author||{}).nickname||"Unknown"}`,m.textContent=`${e.duration||0} seconds`)}(b),i.style.display="block",g("Video information loaded successfully!",100),a.style.pointerEvents="auto",a.style.opacity="1"}else w(o.msg||"Failed to fetch video information")}catch(e){w(e.message),a.style.pointerEvents="none",a.style.opacity="0.5"}}),e.addEventListener("keypress",e=>{"Enter"===e.key&&o.click()}),f.addEventListener("click",()=>{b&&b.play&&("none"===y.style.display?(y.style.display="block",v.src=b.play,v.load(),v.play().catch(e=>{console.log("Video playback failed:",e)})):(y.style.display="none",v.pause()))}),document.querySelectorAll('input[name="format"]').forEach(e=>{e.addEventListener("change",()=>{"mp3"===e.value?(f.style.display="none",y.style.display="none",v.pause()):f.style.display="block"})}),a.addEventListener("click",e=>{b?k():(e.preventDefault(),w("Please preview a video first"))}),r.style.display="none";

// How to Use Modal functionality
h.addEventListener("click", () => {
    M.style.display = "block";
});

U.addEventListener("click", () => {
    M.style.display = "none";
});

window.addEventListener("click", (e) => {
    if (e.target === M) {
        M.style.display = "none";
    }
});

// Add ESC key listener to close modal
document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && M.style.display === "block") {
        M.style.display = "none";
    }
});
}(); 
