!function(){const e=document.getElementById("videoUrl"),t=document.getElementById("pasteBtn"),n=document.getElementById("clearBtn"),o=document.getElementById("previewBtn"),i=document.querySelector(".preview-section"),a=document.getElementById("downloadBtn"),d=document.querySelector(".progress-section"),s=document.querySelector(".progress"),l=document.getElementById("statusText"),r=document.getElementById("openDownloadsBtn"),c=document.getElementById("videoThumbnail"),u=document.getElementById("videoTitle"),p=document.getElementById("videoAuthor"),m=document.getElementById("videoDuration").querySelector("span"),v=document.getElementById("videoPlayer"),y=document.querySelector(".video-player-section"),f=document.getElementById("viewVideoBtn");let h=null;function g(e,t){l.textContent=e,s.style.width=`${t}%`}function w(e){g(`Error: ${e}`,0),d.style.display="block"}async function b(){if(!h)return void w("No video data available");try{const e=document.querySelector('input[name="format"]:checked').value;g("Starting download...",20),d.style.display="block";const t=await fetch("/api/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:document.getElementById("videoUrl").value.trim(),format:e})});if(!(await t.json()).success)throw new Error("Download failed");g("Download ready!",100);const n=`/downloads/tiktok_${Date.now()}.${e}`;a.href=n,a.download=`tiktok_video.${e}`,a.click()}catch(e){w(e.message)}}t.addEventListener("click",async()=>{try{const t=await navigator.clipboard.readText();e.value=t,async function(){const t=e.value.trim();if(!t)return void w("Please enter a TikTok video URL");try{g("Fetching video information...",20),d.style.display="block",y.style.display="none",a.style.pointerEvents="none",a.style.opacity="0.5";const n=await fetch("/api/video-info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:t})});if(!(await n.json()).code===0)throw new Error("Failed to fetch video information");h=data.data,function(e){e&&(c.src=e.cover||"",u.textContent=e.title||"Untitled",p.textContent=`Author: ${(e.author||{}).nickname||"Unknown"}`,m.textContent=`${e.duration||0} seconds`)}(h),i.style.display="block",g("Video information loaded successfully!",100),a.style.pointerEvents="auto",a.style.opacity="1"}catch(e){w(e.message),a.style.pointerEvents="none",a.style.opacity="0.5"}}()}catch(e){w("Failed to paste from clipboard")}}),n.addEventListener("click",()=>{e.value="",i.style.display="none",d.style.display="none",y.style.display="none",v.src="",h=null,a.removeAttribute("href"),a.style.pointerEvents="none",a.style.opacity="0.5"}),o.addEventListener("click",async()=>{const t=e.value.trim();if(!t)return void w("Please enter a TikTok video URL");try{g("Fetching video information...",20),d.style.display="block",y.style.display="none";const n=await fetch("/api/video-info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:t})}),o=await n.json();o.code===0&&o.data?(h=o.data,function(e){e&&(c.src=e.cover||"",u.textContent=e.title||"Untitled",p.textContent=`Author: ${(e.author||{}).nickname||"Unknown"}`,m.textContent=`${e.duration||0} seconds`)}(h),i.style.display="block",g("Video information loaded successfully!",100),a.style.pointerEvents="auto",a.style.opacity="1"):w(o.msg||"Failed to fetch video information")}catch(e){w(e.message)}}),e.addEventListener("keypress",e=>{"Enter"===e.key&&o.click()}),f.addEventListener("click",()=>{h&&h.play&&("none"===y.style.display?(y.style.display="block",v.src=h.play,v.load(),v.play().catch(e=>{console.log("Video playback failed:",e)})):(y.style.display="none",v.pause()))}),document.querySelectorAll('input[name="format"]').forEach(e=>{e.addEventListener("change",()=>{"mp3"===e.value?(f.style.display="none",y.style.display="none",v.pause()):f.style.display="block"})}),a.addEventListener("click",e=>{h?b():(e.preventDefault(),w("Please preview a video first"))}),r.addEventListener("click",()=>{window.open("/downloads","_blank")})}(); 